<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Randomizador agentes Valorant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg: #0f172a;
            --card: #0b1220;
            --accent: #7c3aed;
            --muted: #94a3b8;
            --text: #e6eef8;
        }

        body {
            font-family: Inter, sans-serif;
            margin: 0;
            background: linear-gradient(180deg, #071028 0%, #071229 60%);
            color: var(--text);
            padding: 28px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 18px;
        }

        h1 {
            font-size: 20px;
            margin: 0;
        }

        p.lead {
            color: var(--muted);
            font-size: 13px;
            margin: 0;
        }

        .card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            padding: 14px;
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(2, 6, 23, 0.6);
            margin-bottom: 12px;
        }

        label {
            font-size: 13px;
            color: var(--muted);
            display: block;
            margin-bottom: 6px;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            background: transparent;
            color: var(--text);
            outline: none;
            font-size: 14px;
        }

        .player-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .remove-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 2px 6px;
        }

        .remove-btn:hover {
            color: #ffb4b4;
        }

        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        button.ghost {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: var(--text);
        }

        .assignment {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.02);
        }

        .small {
            font-size: 13px;
            color: var(--muted);
        }

        .danger {
            color: #ffb4b4;
        }
        
        footer {
            margin-top: 18px;
            color: var(--muted);
            font-size: 13px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Randomizador agentes Valorant</h1>
            <p class="lead">Escribe los nombres del equipo y define la composición de roles.</p>
        </header>
        <div class="card">
            <label>Nombres del equipo</label>
            <div id="teamInputs"></div>
            <button id="addPlayerBtn" class="ghost" style="margin-top:8px;">+ Añadir jugador</button>
        </div>
        <div class="card">
            <label>
                <input type="checkbox" id="useRolesCheckbox"> Usar composición de roles
            </label>
            <div id="roleConfig" style="display:none; margin-top: 8px;"></div>
            <p class="small">Puedes ajustar cuántos jugadores de cada rol habrá en el equipo.</p>
        </div>
        <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
            <button id="assignBtn">Asignar agentes</button>
            <button id="exportBtn" class="ghost" style="display: none;">Copiar</button>
            <div style="margin-left:auto" id="status" class="small"></div>
        </div>
        <div class="card" id="resultCard">
            <label>Asignaciones</label>
            <div id="results"></div>
        </div>
    </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const roles = {
        "Duelista": {
            "Jett": "https://static.wikia.nocookie.net/valorant/images/3/35/Jett_icon.png/revision/latest/scale-to-width-down/75?cb=20230909031447",
            "Phoenix": "https://static.wikia.nocookie.net/valorant/images/1/14/Phoenix_icon.png/revision/latest/scale-to-width-down/75?cb=20230606161016",
            "Reyna": "https://static.wikia.nocookie.net/valorant/images/b/b0/Reyna_icon.png/revision/latest/scale-to-width-down/75?cb=20230606161102",
            "Raze": "https://static.wikia.nocookie.net/valorant/images/9/9c/Raze_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180834",
            "Yoru": "https://static.wikia.nocookie.net/valorant/images/f/f0/KAYO_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180711",
            "Neon": "https://static.wikia.nocookie.net/valorant/images/d/d0/Neon_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180744"
        },
        "Centinela": {
            "Sage": "https://static.wikia.nocookie.net/valorant/images/7/74/Sage_icon.png/revision/latest/scale-to-width-down/75?cb=20230606161159",
            "Killjoy": "https://static.wikia.nocookie.net/valorant/images/1/15/Killjoy_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180727",
            "Cypher": "https://static.wikia.nocookie.net/valorant/images/8/88/Cypher_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180623",
            "Chamber": "https://static.wikia.nocookie.net/valorant/images/0/09/Chamber_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180616",
            "Deadlock": "https://static.wikia.nocookie.net/valorant/images/e/eb/Deadlock_icon.png/revision/latest/scale-to-width-down/75?cb=20230627132804"
        },
        "Controlador": {
            "Brimstone": "https://static.wikia.nocookie.net/valorant/images/4/4d/Brimstone_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180558",
            "Viper": "https://static.wikia.nocookie.net/valorant/images/5/5f/Viper_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180950",
            "Omen": "https://static.wikia.nocookie.net/valorant/images/b/b0/Omen_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180801",
            "Astra": "https://static.wikia.nocookie.net/valorant/images/0/08/Astra_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180525",
            "Harbor": "https://static.wikia.nocookie.net/valorant/images/f/f3/Harbor_icon.png/revision/latest/scale-to-width-down/75?cb=20230523161242"
        },
        "Iniciador": {
            "Sova": "https://static.wikia.nocookie.net/valorant/images/4/49/Sova_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180933",
            "Breach": "https://static.wikia.nocookie.net/valorant/images/5/53/Breach_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180542",
            "Skye": "https://static.wikia.nocookie.net/valorant/images/3/33/Skye_icon.png/revision/latest/scale-to-width-down/75?cb=20230606161546",
            "Fade": "https://static.wikia.nocookie.net/valorant/images/a/a6/Fade_icon.png/revision/latest/scale-to-width-down/75?cb=20230523161332",
            "KAY/O": "https://static.wikia.nocookie.net/valorant/images/f/f0/KAYO_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180711",
            "Gekko": "https://static.wikia.nocookie.net/valorant/images/6/66/Gekko_icon.png/revision/latest/scale-to-width-down/75?cb=20230523180641"
        } 
    };
    let playerCount = 5;
    const teamInputsDiv = document.getElementById('teamInputs');
    const addPlayerBtn = document.getElementById('addPlayerBtn');
    const resultsDiv = document.getElementById('results');
    const statusDiv = document.getElementById('status');
    const roleConfigDiv = document.getElementById('roleConfig');
    const useRolesCheckbox = document.getElementById('useRolesCheckbox');
    function renderPlayers(names = []) {
        teamInputsDiv.innerHTML = '';
        playerCount = names.length || 1;
        names.forEach((name, i) => {
            const row = document.createElement('div');
            row.className = 'player-row';

            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = `Jugador ${i + 1}`;
            input.value = name || `Jug${i + 1}`;

            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = '✖';
            removeBtn.addEventListener('click', () => {
                const remaining = names.slice();
                remaining.splice(i, 1);
                renderPlayers(remaining);
            });

            row.appendChild(input);
            row.appendChild(removeBtn);
            teamInputsDiv.appendChild(row);
        });
        addPlayerBtn.style.display = playerCount < 5 ? 'inline-block' : 'none';
    }
    addPlayerBtn.onclick = () => {
        const inputs = Array.from(teamInputsDiv.querySelectorAll('input[type="text"]'));
        if (inputs.length < 5) {
            const currentNames = inputs.map(i => i.value.trim());
            currentNames.push(`Jug${currentNames.length + 1}`);
            renderPlayers(currentNames);
        }
    };
    function renderRoleConfig() {
        roleConfigDiv.innerHTML = '';
        for (const role in roles) {
            const div = document.createElement('div');
            div.className = 'player-row';
            const label = document.createElement('label');
            label.textContent = role;
            label.style.width = '120px';
            const input = document.createElement('input');
            input.type = 'number';
            input.min = 0;
            input.max = 5;
            input.value = 1;
            input.id = `role-${role}`;
            div.appendChild(label);
            div.appendChild(input);
            roleConfigDiv.appendChild(div);
        }
    }
    useRolesCheckbox.addEventListener('change', () => {
        roleConfigDiv.style.display = useRolesCheckbox.checked ? 'block' : 'none';
    });
    function shuffle(arr) {
        const a = arr.slice();
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }
    function getTeamNames() {
        return Array.from(teamInputsDiv.querySelectorAll('input[type="text"]'))
            .map((i, idx) => i.value.trim() || `Jugador ${idx + 1}`);
    }
    function getRoleByAgent(agentName) {
        for (const role in roles) {
            if (roles[role][agentName]) return role;
        }
        return 'Desconocido';
    }
    function getIconByAgent(agentName) {
        for (const role in roles) {
            if (roles[role][agentName]) return roles[role][agentName];
        }
        return '';
    }
    useRolesCheckbox.addEventListener('change', () => {
        roleConfigDiv.style.display = useRolesCheckbox.checked ? 'block' : 'none';
    });
    renderRoleConfig();
    function assignAgents() {
        statusDiv.textContent = '';
        const team = getTeamNames();
        const selectedAgents = [];
        if (useRolesCheckbox.checked) {
            const composition = {};
            let totalNeeded = 0;
            for (const role in roles) {
                const val = parseInt(document.getElementById(`role-${role}`).value) || 0;
                composition[role] = val;
                totalNeeded += val;
            }
            if (totalNeeded !== team.length) {
                statusDiv.innerHTML = `<span class="danger">Error: la suma de roles (${totalNeeded}) debe coincidir con el número de jugadores (${team.length}).</span>`;
                return;
            }
            let agentPool = Object.entries(roles)
                .filter(([role]) => composition[role] > 0)
                .flatMap(([role, agentsObj]) => Object.keys(agentsObj).map(agent => ({ agent, role })));

            const roleCounts = {};
            for (let player of team) {
                if (agentPool.length === 0) {
                    statusDiv.innerHTML = `<span class="danger">Error: no hay suficientes agentes disponibles.</span>`;
                    return;
                }
                const idx = Math.floor(Math.random() * agentPool.length);
                const { agent, role } = agentPool[idx];
                roleCounts[role] = (roleCounts[role] || 0) + 1;
                if (roleCounts[role] >= composition[role]) {
                    agentPool = agentPool.filter(a => a.role !== role);
                } else {
                    agentPool.splice(idx, 1);
                }
                selectedAgents.push({ name: player, agent, role, icon: getIconByAgent(agent) });
            }
        } else {
            const allAgents = Object.values(roles).flatMap(a => Object.keys(a));
            if (team.length > allAgents.length) {
                statusDiv.innerHTML = `<span class="danger">Error: más jugadores que agentes disponibles.</span>`;
                return;
            }
            const shuffled = shuffle(allAgents);
            for (let i = 0; i < team.length; i++) {
                selectedAgents.push({
                    name: team[i],
                    agent: shuffled[i],
                    role: getRoleByAgent(shuffled[i]),
                    icon: getIconByAgent(shuffled[i])
                });
            }
        }
        resultsDiv.innerHTML = '';
        selectedAgents.forEach((a, idx) => {
            const row = document.createElement('div');
            row.className = 'assignment';
            row.innerHTML = `
                <div><strong>${a.name}</strong><div class="small">Jugador ${idx + 1}</div></div>
                <div style="display:flex; align-items:center; justify-content:flex-end; gap:6px;">
                    <div style="display: flex; align-items: flex-end; gap:6px; flex-direction: column; align-content: flex-end;">
                        <strong>${a.agent}</strong>
                        <div class="small" style="display: flex; align-items: flex-end; gap:6px; flex-direction: column; align-content: flex-end;">${a.role}</div>
                    </div>
                    <img src="${a.icon}" alt="${a.agent}" style="height:30px; width:30px; object-fit:contain;">
                </div>
            `;
            resultsDiv.appendChild(row);
        });

        statusDiv.textContent = 'Asignación creada — ' + new Date().toLocaleTimeString();
        document.getElementById('exportBtn').style.display = 'inline-block';
    }
    document.getElementById('assignBtn').onclick = assignAgents;
    document.getElementById('exportBtn').onclick = async () => {
        const div = document.getElementById('resultCard');
        statusDiv.textContent = 'Generando imagen...';
        try {
            const canvas = await html2canvas(div, { backgroundColor: null });
            canvas.toBlob(async (blob) => {
                if (!blob) return;
                try {
                    await navigator.clipboard.write([
                        new ClipboardItem({ 'image/png': blob })
                    ]);
                    statusDiv.textContent = 'Imagen copiada al portapapeles 🎉';
                } catch (err) {
                    console.error(err);
                    statusDiv.textContent = 'Error: no se pudo copiar al portapapeles';
                }
            });
        } catch (err) {
            console.error(err);
            statusDiv.textContent = 'Error generando la imagen';
        }
    };
    function getPlayersFromUrl() {
        const params = new URLSearchParams(window.location.search);
        const jugadoresParam = params.get('jugadores');
        if (!jugadoresParam) return [];
        return jugadoresParam.split(';').map(j => j.trim()).filter(j => j.length);
    }

    const initialPlayers = getPlayersFromUrl();
    renderPlayers(initialPlayers.length ? initialPlayers : ['Jugador 1']);
});
</script>
</body>
</html>
